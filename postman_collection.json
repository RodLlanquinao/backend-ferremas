{
  "info": {
    "name": "FERREMAS Backend API",
    "description": "Colección de endpoints para el backend de FERREMAS - Incluye flujo completo de pedidos y pagos con Webpay\nFlujo típico de un pedido:\n1. POST /pedidos → Crear pedido (estado: pendiente)\n2. POST /api/webpay/crear-transaccion → Iniciar pago (estado: en_proceso)\n3. POST /api/webpay/retorno → Confirmar pago (estado: pagado/rechazado)",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Health Check",
      "item": [
        {
          "name": "Base endpoint",
          "request": {
            "method": "GET",
            "url": "{{base_url}}/",
            "description": "Endpoint base que confirma que el servidor está funcionando"
          }
        },
        {
          "name": "Health check",
          "request": {
            "method": "GET",
            "url": "{{base_url}}/health",
            "description": "Verifica el estado del servidor y la conexión a la base de datos"
          }
        }
      ]
    },
    {
      "name": "Productos",
      "item": [
        {
          "name": "Listar productos",
          "request": {
            "method": "GET",
            "url": "{{base_url}}/productos",
            "description": "Obtiene todos los productos disponibles"
          }
        },
        {
          "name": "Obtener producto por ID",
          "request": {
            "method": "GET",
            "url": "{{base_url}}/productos/{{test_product_id}}",
            "description": "Obtiene un producto específico por su ID"
          }
        },
        {
          "name": "Crear producto",
          "request": {
            "method": "POST",
            "url": "{{base_url}}/productos",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nombre\": \"Sierra Circular\",\n  \"modelo\": \"SC-1200\",\n  \"marca\": \"DeWalt\",\n  \"codigo\": \"DW-SC1200\",\n  \"precio\": 89990,\n  \"stock\": 15,\n  \"categoria\": \"Herramientas Eléctricas\",\n  \"descripcion\": \"Sierra circular profesional 1200W\"\n}",
              "description": "Datos del nuevo producto"
            },
            "description": "Crea un nuevo producto en el sistema"
          }
        },
        {
          "name": "Actualizar producto",
          "request": {
            "method": "PUT",
            "url": "{{base_url}}/productos/{{test_product_id}}",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nombre\": \"Sierra Circular\",\n  \"modelo\": \"SC-1200\",\n  \"marca\": \"DeWalt\",\n  \"codigo\": \"DW-SC1200\",\n  \"precio\": 94990,\n  \"stock\": 20,\n  \"categoria\": \"Herramientas Eléctricas\",\n  \"descripcion\": \"Sierra circular profesional 1200W con maleta\"\n}",
              "description": "Datos actualizados del producto"
            },
            "description": "Actualiza un producto existente"
          }
        },
        {
          "name": "Eliminar producto",
          "request": {
            "method": "DELETE",
            "url": "{{base_url}}/productos/{{test_product_id}}",
            "description": "Elimina un producto del sistema"
          }
        },
        {
          "name": "Obtener productos por categoría",
          "request": {
            "method": "GET",
            "url": "{{base_url}}/productos/categoria/{{categoria}}",
            "description": "Obtiene todos los productos de una categoría específica"
          }
        }
      ]
    },
    {
      "name": "Usuarios",
      "item": [
        {
          "name": "Obtener usuario",
          "request": {
            "method": "GET",
            "url": "{{base_url}}/usuarios/{{test_user_id}}",
            "description": "Obtiene los datos de un usuario específico"
          }
        },
        {
          "name": "Crear usuario",
          "request": {
            "method": "POST",
            "url": "{{base_url}}/usuarios",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nombre\": \"Carlos Rodríguez\",\n  \"email\": \"carlos.rodriguez@test.com\",\n  \"telefono\": \"+56912345681\",\n  \"direccion\": \"Av. Principal 789\"\n}",
              "description": "Datos del nuevo usuario"
            },
            "description": "Crea un nuevo usuario en el sistema"
          }
        },
        {
          "name": "Actualizar usuario",
          "request": {
            "method": "PUT",
            "url": "{{base_url}}/usuarios/{{test_user_id}}",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nombre\": \"Carlos Alberto Rodríguez\",\n  \"email\": \"carlos.rodriguez@test.com\",\n  \"rol\": \"cliente\"\n}",
              "description": "Datos actualizados del usuario"
            },
            "description": "Actualiza los datos de un usuario existente"
          }
        },
        {
          "name": "Eliminar usuario",
          "request": {
            "method": "DELETE",
            "url": "{{base_url}}/usuarios/{{test_user_id}}",
            "description": "Elimina un usuario del sistema"
          }
        }
      ]
    },
    {
      "name": "Pedidos",
      "description": "Gestión de pedidos - Incluye creación, consulta y seguimiento del estado de los pedidos",
      "item": [
        {
          "name": "Obtener pedido por ID",
          "request": {
            "method": "GET",
            "url": "{{base_url}}/pedidos/{{pedido_id}}",
            "description": "Obtiene los detalles completos de un pedido específico, incluyendo información del producto, usuario y estado de pago"
          },
          "response": [
            {
              "name": "Ejemplo respuesta exitosa",
              "originalRequest": {
                "method": "GET",
                "url": "{{base_url}}/pedidos/123"
              },
              "status": "OK",
              "code": 200,
              "body": "{\n  \"success\": true,\n  \"data\": {\n    \"id\": 123,\n    \"producto_id\": 34,\n    \"usuario_id\": 9,\n    \"cantidad\": 2,\n    \"estado\": \"en_proceso\",\n    \"fecha_pedido\": \"2023-11-25T12:00:00Z\",\n    \"monto\": 179980,\n    \"producto_nombre\": \"Sierra Circular DeWalt\",\n    \"usuario_nombre\": \"Carlos Rodríguez\",\n    \"transbank_token\": \"01ab2cd3\",\n    \"transbank_status\": \"INITIALIZED\",\n    \"buy_order\": \"ORD-123-4567\"\n  },\n  \"message\": \"Pedido obtenido exitosamente\"\n}"
            }
          ]
        },
        {
          "name": "Obtener pedidos por usuario",
          "request": {
            "method": "GET",
            "url": "{{base_url}}/pedidos/usuario/{{test_user_id}}",
            "description": "Obtiene todos los pedidos de un usuario específico"
          },
          "response": [
            {
              "name": "Ejemplo respuesta exitosa",
              "status": "OK",
              "code": 200,
              "body": "{\n  \"success\": true,\n  \"data\": [\n    {\n      \"id\": 123,\n      \"producto_id\": 34,\n      \"usuario_id\": 9,\n      \"cantidad\": 2,\n      \"estado\": \"pagado\",\n      \"fecha_pedido\": \"2023-11-25T12:00:00Z\",\n      \"monto\": 179980,\n      \"producto_nombre\": \"Sierra Circular DeWalt\",\n      \"usuario_nombre\": \"Carlos Rodríguez\",\n      \"transbank_token\": \"01ab2cd3\",\n      \"transbank_status\": \"AUTHORIZED\",\n      \"buy_order\": \"ORD-123-4567\"\n    }\n  ],\n  \"message\": \"Pedidos del usuario obtenidos exitosamente\"\n}"
            }
          ]
        },
        {
          "name": "Crear pedido",
          "request": {
            "method": "POST",
            "url": "{{base_url}}/pedidos",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"producto_id\": {{test_product_id}},\n  \"usuario_id\": {{test_user_id}},\n  \"cantidad\": 2,\n  \"estado\": \"pendiente\",\n  \"fecha_pedido\": \"{{$isoTimestamp}}\"\n}",
              "description": "Datos del nuevo pedido. El monto se calcula automáticamente basado en el precio del producto × cantidad"
            },
            "description": "Crea un nuevo pedido en el sistema. El monto se calcula automáticamente."
          },
          "response": [
            {
              "name": "Ejemplo respuesta exitosa",
              "originalRequest": {
                "method": "POST",
                "url": "{{base_url}}/pedidos",
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"producto_id\": 34,\n  \"usuario_id\": 9,\n  \"cantidad\": 2\n}"
                }
              },
              "status": "Created",
              "code": 201,
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": "{\n  \"success\": true,\n  \"data\": {\n    \"id\": 123,\n    \"producto_id\": 34,\n    \"usuario_id\": 9,\n    \"cantidad\": 2,\n    \"estado\": \"pendiente\",\n    \"fecha_pedido\": \"2023-11-25T12:00:00Z\",\n    \"monto\": 179980,\n    \"producto_nombre\": \"Sierra Circular DeWalt\",\n    \"usuario_nombre\": \"Carlos Rodríguez\"\n  },\n  \"message\": \"Pedido creado exitosamente\"\n}"
            }
          ]
        },
        {
          "name": "Actualizar pedido",
          "request": {
            "method": "PUT",
            "url": "{{base_url}}/pedidos/{{pedido_id}}",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"producto_id\": {{test_product_id}},\n  \"usuario_id\": {{test_user_id}},\n  \"cantidad\": 1,\n  \"estado\": \"en_proceso\",\n  \"fecha_pedido\": \"{{$isoTimestamp}}\",\n  \"monto\": 89990,\n  \"transbank_token\": null,\n  \"transbank_status\": null,\n  \"buy_order\": null\n}",
              "description": "Datos actualizados del pedido"
            },
            "description": "Actualiza el estado u otros datos de un pedido existente. Estados válidos: pendiente, en_proceso, pagado, rechazado, error. Se deben incluir todos los campos requeridos por el validador."
          }
        },
        {
          "name": "Eliminar pedido",
          "request": {
            "method": "DELETE",
            "url": "{{base_url}}/pedidos/{{pedido_id}}",
            "description": "Elimina un pedido del sistema"
          }
        }
      ]
    },
    {
      "name": "Contacto",
      "item": [
        {
          "name": "Listar mensajes",
          "request": {
            "method": "GET",
            "url": "{{base_url}}/contacto",
            "description": "Obtiene todos los mensajes de contacto"
          }
        },
        {
          "name": "Obtener mensaje",
          "request": {
            "method": "GET",
            "url": "{{base_url}}/contacto/{{mensaje_id}}",
            "description": "Obtiene un mensaje de contacto específico"
          }
        },
        {
          "name": "Crear mensaje",
          "request": {
            "method": "POST",
            "url": "{{base_url}}/contacto",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nombre\": \"Carlos Rodríguez\",\n  \"email\": \"carlos.rodriguez@test.com\",\n  \"asunto\": \"Consulta sobre herramientas eléctricas\",\n  \"mensaje\": \"Me gustaría saber si tienen más modelos de sierras circulares disponibles.\"\n}",
              "description": "Datos del nuevo mensaje de contacto"
            },
            "description": "Crea un nuevo mensaje de contacto"
          }
        },
        {
          "name": "Eliminar mensaje",
          "request": {
            "method": "DELETE",
            "url": "{{base_url}}/contacto/{{mensaje_id}}",
            "description": "Elimina un mensaje de contacto"
          }
        }
      ]
    },
    {
      "name": "Webpay",
      "description": "Flujo de pago con Webpay - Desde la creación de la transacción hasta la confirmación del pago",
      "item": [
        {
          "name": "Crear transacción",
          "request": {
            "method": "POST",
            "url": "{{base_url}}/api/webpay/crear-transaccion",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"pedido_id\": {{pedido_id}}\n}",
              "description": "ID del pedido para procesar el pago"
            },
            "description": "Inicia una transacción de pago con Webpay. Retorna un formulario HTML que redirige al usuario a Webpay. El pedido debe tener un monto válido."
          },
          "response": [
            {
              "name": "Ejemplo respuesta exitosa",
              "status": "OK",
              "code": 200,
              "header": [
                {
                  "key": "Content-Type",
                  "value": "text/html; charset=utf-8"
                }
              ],
              "body": "<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Procesando Pago - Ferremas</title>\n    <!-- ... Contenido HTML del formulario de redirección ... -->\n</head>\n<body>\n    <form id=\"webpay-form\" method=\"POST\" action=\"https://webpay3gint.transbank.cl/...\">\n        <input type=\"hidden\" name=\"token_ws\" value=\"01ab2cd3\" />\n    </form>\n    <script>\n        document.getElementById('webpay-form').submit();\n    </script>\n</body>\n</html>"
            }
          ]
        },
        {
          "name": "Retorno de pago (POST)",
          "request": {
            "method": "POST",
            "url": "{{base_url}}/api/webpay/retorno",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "token_ws",
                  "value": "{{transbank_token}}",
                  "description": "Token de la transacción proporcionado por Webpay"
                }
              ]
            },
            "description": "URL de retorno después del proceso de pago. Webpay redirige aquí con el resultado de la transacción."
          },
          "response": [
            {
              "name": "Ejemplo pago exitoso",
              "status": "OK",
              "code": 200,
              "header": [
                {
                  "key": "Content-Type",
                  "value": "text/html; charset=utf-8"
                }
              ],
              "body": "<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Pago Exitoso - Ferremas</title>\n</head>\n<body>\n    <div class=\"container\">\n        <h1>¡Pago Exitoso!</h1>\n        <p>Tu pago ha sido procesado correctamente</p>\n        <div class=\"details\">\n            <p><strong>Orden:</strong> ORD-123-4567</p>\n            <p><strong>Monto:</strong> $179.980</p>\n            <p><strong>Estado:</strong> Autorizado</p>\n        </div>\n    </div>\n</body>\n</html>"
            },
            {
              "name": "Ejemplo pago rechazado",
              "status": "OK",
              "code": 200,
              "header": [
                {
                  "key": "Content-Type",
                  "value": "text/html; charset=utf-8"
                }
              ],
              "body": "<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Pago No Autorizado - Ferremas</title>\n</head>\n<body>\n    <div class=\"container\">\n        <h1>Pago No Autorizado</h1>\n        <p>La transacción fue procesada pero no fue autorizada.</p>\n        <div class=\"details\">\n            <p><strong>Orden:</strong> ORD-123-4567</p>\n            <p><strong>Estado:</strong> REJECTED</p>\n        </div>\n    </div>\n</body>\n</html>"
            }
          ]
        },
        {
          "name": "Página final (GET)",
          "request": {
            "method": "GET",
            "url": "{{base_url}}/api/webpay/retorno",
            "description": "Página final mostrada después del proceso de pago"
          },
          "response": [
            {
              "name": "Ejemplo respuesta",
              "status": "OK",
              "code": 200,
              "header": [
                {
                  "key": "Content-Type",
                  "value": "text/html; charset=utf-8"
                }
              ],
              "body": "<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Confirmación - Ferremas</title>\n</head>\n<body>\n    <div class=\"container\">\n        <h1>Pago Procesado</h1>\n        <p>Gracias por tu compra. Tu pedido ha sido registrado correctamente.</p>\n        <p>Estado: Completado</p>\n        <p>Fecha: {{$timestamp}}</p>\n    </div>\n</body>\n</html>"
            }
          ]
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:8000",
      "description": "URL base del servidor en desarrollo"
    },
    {
      "key": "test_product_id",
      "value": "34",
      "description": "ID de producto de prueba (Sierra Circular DeWalt)"
    },
    {
      "key": "test_user_id",
      "value": "9",
      "description": "ID de usuario de prueba (Carlos Rodríguez)"
    },
    {
      "key": "pedido_id",
      "value": "123",
      "description": "ID de pedido de ejemplo"
    },
    {
      "key": "mensaje_id",
      "value": "17",
      "description": "ID del mensaje de contacto de ejemplo"
    },
    {
      "key": "categoria",
      "value": "Herramientas Eléctricas",
      "description": "Nombre de la categoría de ejemplo"
    },
    {
      "key": "transbank_token",
      "value": "01ab2cd3",
      "description": "Token de ejemplo de Webpay"
    }
  ]
}

